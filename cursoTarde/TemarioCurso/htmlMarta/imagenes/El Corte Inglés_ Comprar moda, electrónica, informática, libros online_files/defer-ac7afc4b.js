import{u as U}from"./usePriceFormat-08962b3d.js";import{z as B,an as L,h as c,H as O,o as m,c as u,a as n,n as f,t as d,j as C,L as D,M as b,v as P,P as v,m as M,ad as l,ae as N,af as E}from"./vuex.esm-bundler-f8eff60d.js";import{_ as V}from"./_plugin-vue_export-helper-c27b6911.js";import{n as F}from"./Modal-4b0c1909.js";const x=Object.freeze({MAX_UNITS:"checkout.errors.CRT009"}),q={SIMPLE:"SIMPLE",COMPLEX:"COMPLEX"};const y={props:{className:{type:String,default:""},hasPriceRange:{type:Boolean,default:!1},hasColorSelector:{type:Boolean,default:!1},isCollection:{type:Boolean,default:!1},isPDP:{type:Boolean,default:!1},isProductPreview:{type:Boolean,default:!1},item:{type:Object,required:!0},isMainPriceOnPDP:{type:Boolean,default:!1}},setup(e){const{getFormattedPrice:s}=U(),t=B(2),i=L("mustShowRecommendedPrice",!1),a=c(()=>e.item&&"unit_sale_price"in e.item&&e.item.unit_sale_price!==null&&e.item.unit_sale_price!==void 0),r=c(()=>!!(e.item.discount&&i===!0&&e.item.unit_price)),o=c(()=>e.isPDP?r.value?"1rem 1rem":"1rem":"min-content min-content"),p=c(()=>e.isPDP&&e.item.pumOrPackComposition&&e.hasPriceRange&&r.value?(t.value=3,"max-content max-content 1fr"):(e.item.pumOrPackComposition&&e.hasPriceRange&&(t.value=3),e.isPDP&&!e.hasPriceRange&&e.item.pumOrPackComposition&&!r.value?e.isMainPriceOnPDP?(t.value=2,"max-content 1fr"):(t.value=1,"1fr"):!e.isProductPreview&&!e.hasPriceRange&&e.item.pumOrPackComposition&&!r.value?(t.value=1,"1fr"):"max-content 1fr")),h=c(()=>e.isProductPreview||e.hasPriceRange||e.item.pumOrPackComposition?"0.5rem":"0"),_=c(()=>r?"0.3rem":"0"),g=c(()=>({"price-sale":!i,"price-regular":i})),w=c(()=>s(e.item.unit_price,e.isCollection)),R=c(()=>s(e.item.unit_sale_price,e.isCollection)),A=c(()=>a.value?R.value:w.value),k=c(()=>a.value?e.item.unit_sale_price:e.item.unit_price);return{formattedPriceWithoutDiscount:A,formattedUnitPrice:w,formattedUnitSalePrice:R,hasRecommendedPrice:r,mainPriceStyle:g,mustShowRecommendedPrice:i,PriceTypes:q,priceWithoutDiscount:k,pumPositionColumn:t,setGAP:h,setMarginBottom:_,setNumberOfColumns:p,setNumberOfRows:o}}},I=()=>{O(e=>({"57689d11":e.setMarginBottom,"3c894625":e.setNumberOfColumns,c0308ede:e.setNumberOfRows,d2e6d784:e.setGAP,"07aff79d":e.pumPositionColumn}))},S=y.setup;y.setup=S?(e,s)=>(I(),S(e,s)):I;const T=e=>(D("data-v-37718af3"),e=e(),b(),e),j=["aria-label"],G={key:1,class:"price-container"},Q={itemprop:"offers",itemtype:"http://schema.org/Offer",itemscope:""},W=T(()=>n("meta",{itemprop:"priceCurrency",content:"EUR"},null,-1)),X=["content"],z=["content"],K=["content"],Y=["aria-label"],H=["aria-label"],J=["aria-label"],Z={key:2,class:"price-container"},$={itemprop:"offers",itemtype:"http://schema.org/Offer",itemscope:""},ee=T(()=>n("meta",{itemprop:"priceCurrency",content:"EUR"},null,-1)),te=["content"],ie=["content"],se=["content"],re=["aria-label"],ae={key:3,class:"price-pum"},ne=["aria-label"];function oe(e,s,t,i,a,r){return m(),u("section",{"aria-label":e.$t("product.price.title"),class:"price"},[n("div",{class:f(["price--main",{"price-with-recommended":i.mustShowRecommendedPrice}])},[t.hasPriceRange?(m(),u("div",{key:0,class:f(["price--range",{"price--range--discount":t.item.discount,"price--with_color":t.hasColorSelector,"price-range-with-recommended":i.mustShowRecommendedPrice}])},d(e.$t("product.price.from")),3)):C("",!0),t.item.discount?(m(),u("div",G,[n("div",Q,[W,n("meta",{itemprop:"price",content:t.item.unit_sale_price},null,8,X),n("meta",{itemprop:"lowPrice",content:t.item.unit_sale_price},null,8,z),n("meta",{itemprop:"highPrice",content:t.item.unit_price},null,8,K)]),n("span",{"aria-label":e.$t("product.price.sale_price"),class:f(i.mainPriceStyle)},d(i.formattedUnitSalePrice),11,Y),i.mustShowRecommendedPrice?C("",!0):(m(),u("span",{key:0,"aria-label":e.$t("product.price.original_price"),class:f(["price-unit--original",t.className])},d(i.formattedUnitPrice),11,H)),i.mustShowRecommendedPrice?C("",!0):(m(),u("span",{key:1,"aria-label":e.$t("product.price.discount"),class:"price-discount"},d(t.item.discount)+"% ",9,J))])):(m(),u("div",Z,[n("div",$,[ee,n("meta",{itemprop:"price",content:i.priceWithoutDiscount},null,8,te),n("meta",{itemprop:"highPrice",content:i.priceWithoutDiscount},null,8,ie),n("meta",{itemprop:"lowPrice",content:t.item.unit_price},null,8,se)]),n("span",{"aria-label":e.$t("product.price.sale_price"),class:f(["price-unit--normal",t.className])},d(i.formattedPriceWithoutDiscount),11,re)])),t.item.pumOrPackComposition?(m(),u("div",ae,d(t.item.pumOrPackComposition),1)):C("",!0),i.hasRecommendedPrice?(m(),u("div",{key:4,"aria-label":e.$t("product.price.recommended_price"),class:f(["price-recommended",t.className])},d(e.$t("product.price.recommended_price"))+" "+d(i.formattedUnitPrice),11,ne)):C("",!0)],2)],8,j)}const _e=V(y,[["render",oe],["__scopeId","data-v-37718af3"]]),ce={inject:{richRelevance:{default:()=>({hasRichRelevance:!1})}},computed:{...P("cart",{isLogged:"isLogged",getUser:"getUser"})},methods:{sendAddToCartEventToRR(e){var i;const s=v.getCookieValue("cookiesPolicy");let t=!1;(s==="1"||(s==null?void 0:s.charAt(2))==="1")&&(t=!0),t&&((i=this.richRelevance)!=null&&i.hasRichRelevance)&&(e!=null&&e.length)&&setTimeout(()=>{var h;const a=this.isLogged&&((h=this.getUser)==null?void 0:h.id),r=v.getCookieValue("session_id"),o=new window.r3_common;o.setApiKey(this.richRelevance.api_key),o.setBaseUrl(this.richRelevance.frontendURL),o.setSessionId(r),a&&o.setUserId(a),o.addPlacementType("add_to_cart_page");const p=new window.r3_addtocart;e.forEach(_=>{p.addItemIdToCart(_.data_layer.code_a,_.data_layer.variant)}),window.rr_flush_onload(),window.r3()},0)}}},pe={mixins:[F,ce],computed:{...P("cart",{isLoadingCart:"getLoadingStatus",getFullCartData:"getFullCartData",getTotalItems:"getTotalItems",getApiResponse:"getApiResponse",isEciCardError:"isEciCardError",hasCouponError:"hasCouponError",isLogged:"isLogged",getUser:"getUser",getGuestEmail:"getGuestEmail"}),...P("page",{isApp:"isApp",internals:"getInternals"})},methods:{...M("cart",{getCart:"getCart",deleteItemByCart:"deleteItemByCart",postCart:"postCart",postCouponCode:"postCouponCode",putCart:"putCart",showExpiredCartError:"showExpiredCartError",processToCheckout:"processToCheckout",postCartVpr:"postCartVpr"}),hasExpiredCartQuery(){var i,a,r;const e=(r=(a=(i=this.internals)==null?void 0:i.req)==null?void 0:a.query)==null?void 0:r.expired;this.getTotalItems<1&&e==="true"&&this.showExpiredCartError({status:!0,msg:this.$i18n.t("checkout.errors.EXPIRED_CART")})},sendPutCart(e){this.putCart(e)},emptyCart(){this.sendPutCart({}),this.isApp&&l.messageEmptyCart()},sendGiftTicketCart(e){this.postCart(e)},async sendGetCart(){var s,t,i;(i=(t=(s=this.internals)==null?void 0:s.req)==null?void 0:t.query)!=null&&i.modal||(await this.getCart(),this.hasExpiredCartQuery(),this.isApp&&(l.messageSessionCartUpdate(),l.messageSendUnits(this.getTotalItems)))},async sendUpdateItemCart(e,s,t=N.BASKET,i=void 0){var p,h,_;const a=!!s,r={...((p=e.line_items)==null?void 0:p[0])&&{line_items:e.line_items},...((h=e.free_gift_skus)==null?void 0:h[0])&&{free_gift_skus:e.free_gift_skus},...((_=e.insurance_items)==null?void 0:_[0])&&{insurance_items:e.insurance_items}};if(this.isApp){if(!this.isLogged)return l.messageNeedLogin();const g=await this.sendPostToCart(r,a,t,i);return await this.sendPostCartToApp("add_item"),g}const o=await this.sendPostToCart(r,a,t,i);return this.sendAddToCartEventToRR(e.line_items),o},addToCartAMV(e){Android.addToCartUnits(e.reference,e.gtin,e.url,e.units)},async handleBuyLaterAddToCart(e){if(this.isApp)return this.isLogged?(await this.postCart(e),this.sendPostCartToApp("add_item")):l.messageNeedLogin();await this.postCart(e)},async sendDeleteItemCart(e,s){if(this.isApp)return this.isLogged?(await this.deleteItemByCart({line_items:e,is_from_checkout:s}),this.sendPostCartToApp("remove_item")):l.messageNeedLogin();await this.deleteItemByCart({line_items:e,is_from_checkout:s})},sendPostCartToApp(e){const s=this.getApiResponse;if(s.error)return;const t=s.response;t[e]=!0,l.messageUpdateCart(t),l.messageSendUnits(this.getTotalItems)},hasReachedMaxInsuranceUnits(e){return E.isInsurance(e)&&!E.canAddInsuranceItem(this.getFullCartData.items,e.insurable_ref)},hasReachedMaxUnits(e){return e.description===x.MAX_UNITS||this.hasReachedMaxInsuranceUnits(e)},async sendPostToCart(e,s,t,i){return i?this.postCartVpr({...e,is_from_checkout:s,successAction:t,vprPostalCode:i}):this.postCart({...e,is_from_checkout:s,successAction:t})}}},fe=function(e,s=!1){const t=function(...i){const a=this;return new Promise(r=>{me(()=>{const o=e.apply(a,i);r(o)})})};return s?t():t},me=e=>{window!=null&&window.requestAnimationFrame?window.requestAnimationFrame(()=>window.requestAnimationFrame(e)):setTimeout(e)};export{x as B,_e as P,q as a,pe as c,fe as d};
//# sourceMappingURL=defer-ac7afc4b.js.map
