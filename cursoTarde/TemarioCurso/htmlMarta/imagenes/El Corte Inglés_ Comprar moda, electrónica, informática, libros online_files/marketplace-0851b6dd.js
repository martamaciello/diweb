import{Q as m}from"./vuex.esm-bundler-f8eff60d.js";const{STATUS:g}=m,h="HOME_DELIVERY",a="Domicilio",l="España peninsular, Mallorca";function y(e,i){var o;if(!e||!i)return;const r=(o=e.mkp_preferred)==null?void 0:o[i];if(r!=null&&r._price)return{unit_price:r._stroked_price||r._price,unit_sale_price:r._price,onsale:r._on_sale,discount:r._discount}}function k(e,i,r){if(!e||!i||!r)return!1;const{hasPreferredProducts:o}=f(e);if(!o)return!1;const t=p(e,r);return t!=null&&t._price?(i.unit_price=t._stroked_price||t._price,i.unit_sale_price=t._price,i.onsale=t._on_sale,i.discount=t._discount,!0):!1}function v(e,i){const r=i==null?void 0:i.stockReference;if(!e||!r)return!1;const{hasPreferredProducts:o}=f(e);if(!o)return!1;const t=p(e,r);return t!=null&&t._price?(i.price=t._stroked_price||t._price,i.sale_price=t._price,i.onsale=t._on_sale,i.discount=t._discount,!0):!1}function S(e,i){const{hasPreferredProducts:r,productsWithPreferredInfo:o}=f(e);if(!r)return!1;const t=i||o[0];if(!t)return!1;const n=p(e,t);return n!=null&&n._price?{unit_price:n._stroked_price||n._price,unit_sale_price:n._price,onsale:n._on_sale,discount:n._discount,unit_price_agrupation:n.unit_price,unit_price_pum:n.unit_price_pum}:!1}function f(e){const r=Object.keys(e.products).filter(function(t){var n;return Object.keys(e.products[t].mkp_preferred||{}).length>0&&((n=e.products[t].status)==null?void 0:n.toUpperCase())===g.ADD});return{hasPreferredProducts:r&&r.length,productsWithPreferredInfo:r}}function w(e,i){const o=Object.keys(e.products).filter(function(n){var s,c;if(i&&e.products[n].priorizated_shipping){const u=(c=(s=e.products[n])==null?void 0:s.priorizated_shipping)==null?void 0:c.filter(_=>_.shipping_method===h&&_.type===i);return e.products[n].status==="ADD"&&u&&u.length>0}else return e.products[n].has_prioritized_shipping&&e.products[n].status==="ADD"});return{hasPreferredProducts:o&&o.length,productsWithPriorizatedShippingInfo:o}}function p(e,i){const r=e.products[i].mkp_preferred;return r==null?void 0:r[i]}function z(e,i){if(!e)return;const{hasOnePrioritizedProduct:r,productsWithPrioritizedShippingInfo:o}=E(e);if(!r)return;const t=o[0];var n=P(e,t);O(n,e.type,i,t),D(i)}function D(e){e&&e.marketplace_shippings&&(e.delivery_time_with_stock=e.marketplace_shippings.delivery_time_with_stock,e.delivery_time_without_stock=e.marketplace_shippings.delivery_time_without_stock,e.delivery_time_with_stock_exact_time=e.marketplace_shippings.delivery_time_with_stock_exact_time,e.delivery_time_without_stock_exact_time=e.marketplace_shippings.delivery_time_without_stock_exact_time)}function M(e,i,r,o){if(!e||!i||!r)return!1;const{hasPreferredProducts:t,productsWithPriorizatedShippingInfo:n}=w(e,"MKP");if(!t)return!1;const s=o||n[0],c=P(e,s);if(!c||!c.offer)return!1;const u=r&&Array.isArray(r.variants)&&r.variants.find(d=>d.stockReference==s);if(!u||!u.providers)return;const _=u.providers.find(d=>d.offer.offer_id===c.offer);return i.delivery_time_with_stock=_.delivery_time_with_stock,i.delivery_time_without_stock=_.delivery_time_without_stock,i.delivery_time_with_stock_exact_time=_.delivery_time_with_stock_exact_time,i.delivery_time_without_stock_exact_time=_.delivery_time_without_stock_exact_time,!0}function O(e,i,r,o){const t=r&&r.marketplace_shippings&&r.marketplace_shippings.marketplace_shipping_providers;if(!t)return;console.log(e);let n;if(i==="product"){if(n=x(t,e),!n)return}else i==="reference"&&(n=A(o,t,e));if(!n)return;const s=T(n,a,l),c=r.available.find(u=>u.place.indexOf(l)!==-1);c&&Array.isArray(c.data)&&c.data.filter(u=>u.store.indexOf(a)!==-1).forEach(u=>{u.values.cost=s})}function E(e){const r=Object.keys(e.products).filter(function(t){return e.products[t].has_prioritized_shipping});return{hasOnePrioritizedProduct:r&&r.length&&r.length===1,productsWithPrioritizedShippingInfo:r}}function P(e,i){var o,t;const r=(t=(o=e.products[i])==null?void 0:o.priorizated_shipping)==null?void 0:t.filter(n=>n.shipping_method===h&&n.type==="MKP");if(!(!r||!r.length))return r[0]}function x(e,i){const r=e.filter(function(o){return o&&o.providers&&o.providers.length&&o.providers.filter(function(n){return n.offer&&n.offer.offer_id===i.offer}).length>0});if(r.length)return r[0]}function A(e,i,r){const o=e.split(":")[0];let t=i.filter(function(s){return s.gtin.trim()===o.trim()});if(t&&t.length&&(t=t[0]),t&&t.providers&&t.providers.length){var n=t.providers.filter(function(s){return s.offer&&s.offer.offer_id&&s.offer.offer_id===r.offer});if(n&&n.length)return n[0]}}function T(e,i,r){if(!e||!e.available||!i)return;let o=e.available.filter(function(c){return c.title&&c.title===i});if(o&&o.length)o=o[0];else return;let n=o.locations.filter(function(c){return c.title===r});if(n&&n.length)n=n[0];else return;let s=n.shipping;return s&&s.indexOf("EUR")!==-1&&(s=s.replace("EUR","€")),s}var b={getReferredMKPPrice:S,updatePriceFromMarketplate:k,updateShippingDataFromMarketplace:z,updatePriceProductPreviewFromMarketplace:y,updateShippingDatesFromMarketplacePreferred:M,updateVariantPriceFromMarketplace:v};export{b as m};
//# sourceMappingURL=marketplace-0851b6dd.js.map
