import{X as $,z as M,J as ee,an as te,A as Q,ac as se,Q as k,a4 as X,a6 as oe,v as Y,f as A,o as v,c as C,t as re,j as D,a as j,k as T,w as J,n as ae,I as ne,P as ce,r as ie,F as le}from"./vuex.esm-bundler-f8eff60d.js";import{e as de,m as ue,c as pe,a as fe}from"./state-0c727e5f.js";import{_ as B}from"./_plugin-vue_export-helper-c27b6911.js";import{M as he}from"./MultiCarousel-20aec040.js";import{P as me}from"./ProductPreview-b4d5116b.js";import{C as _e}from"./crossSellingTypes-8618da4f.js";import{b as ge}from"./Render-4448ec15.js";import{n as Se}from"./navigatorDetect-1d2a0641.js";const ye=new $("/api/vuestore"),Pe=()=>({getRichRelevanceProducts:async a=>{let e=[];return await ye.getRichRelevanceProducts(a).then(o=>{e=o},o=>{console.error(o)}).catch(o=>{console.error(o)}),e}}),ke=r=>{const a=M([]),e=ee({}),{getStock:o}=de("page",{getStock:"getStock"}),f=ue("page","addGiftsWithStock"),c=pe("page/getGiftsWithStock"),l=M([]),h=te("hidePromotions"),u=()=>{var t,n;return(t=a.value)!=null&&t.length?(n=r.value)==null?void 0:n.map(s=>{var F,N,O,z,U,V,q,H,W;const i=(N=(F=e.products)==null?void 0:F[s.id])!=null?N:{},S=i.redirectToPDP||s._is_collection||((O=i.status)==null?void 0:O.toUpperCase())===k.STATUS.FORM,{previewDate:_}=i,K=k.productHasPromotionalProducts(e,s.id);let x=[],I=[],E=[],L=s._my_colors;return K?(x=e.promos[s.id].filter(R=>{var w;return R.type==="gift"?(w=R.target_references)==null?void 0:w.some(b=>{const Z=b.includes(":")?b.split(":")[0]:b;return c.value.includes(Z)}):!0}),I=x):I=(U=(z=e.promos)==null?void 0:z[s.id])!=null?U:[],L=k.updateVariantSpecificPromos(s,I),(q=(V=e.principalGifs)==null?void 0:V[s.id])!=null&&q.is_product_promo?x.find(R=>{var w;return R.id===((w=e.principalGifs)==null?void 0:w[s.id].promo_id)})&&(E=e.principalGifs[s.id]):E=(W=(H=e.principalGifs)==null?void 0:H[s.id])!=null?W:{},{...s,previewDate:_,principal_gif:E,principal_promo:I,redirectToPDP:S,stock:i,updatedMyColors:L}}):r.value};Q(()=>se(p));const p=async()=>{const t=d();if(!(t!=null&&t.length)){l.value=u();return}m(t);const n={ids:t,type:"product"},s=await o(n);g(s,n.ids)},m=t=>{a.value=[...a.value,...t]},d=()=>{var n,s;return(s=(n=r.value)==null?void 0:n.reduce((i,S)=>(y(S)&&i.push(S.id),i),[]))!=null?s:[]},y=({_my_colors:t,id:n})=>{if(!n||a.value.find(_=>_===n))return;const i=({add_to_cart:_})=>k.shouldCheckStock(_);return t==null?void 0:t.some(i)},g=(t,n)=>{const s=!t||!t.data?k.getDefaultStockResponse(n):t.data;(!t||!t.data)&&console.error("[AsyncStock] Error fetching stock. ",t);const{products:i,principalGifs:S,promos:_}=s;e.products={...e.products,...i},e.principalGifs={...e.principalGifs,...S},e.promos={...e.promos,..._},l.value=u(),!h&&P(t)},P=async t=>{const n=k.getAllGiftReferencesFromStock(t.data).filter(s=>{const i=s.includes(":")?s.split(":")[0]:s;return!a.value.includes(s)&&!c.value.includes(i)});m(n),n.length&&o({ids:n,type:"gifts"}).then(s=>G(s))},G=async t=>{if(!(t!=null&&t.success))return console.error("[AsyncStock] Error fetching gifts stock",t);await f(t.data.ADD),l.value=u()};return{stockProducts:l}},ve={name:"AsyncStock",props:{products:{type:Array,required:!0,default:()=>[]}},setup(r){const{products:a}=X(r),{stockProducts:e}=ke(a);return{stockProducts:e}}};function Ce(r,a,e,o,f,c){return oe(r.$slots,"default",{stockProducts:o.stockProducts})}const we=B(ve,[["render",Ce]]),Ie={name:"CrossSelling",components:{AsyncStock:we,MultiCarousel:he,ProductPreview:me},provide:function(){return{crossSellingType:this.type,hidePromotions:!this.mustShowCrossSellingPromotions,getDataLayer:()=>this.dataLayer}},props:{dataLayer:{type:Array,default:()=>[]},title:{type:String,default:""},products:{type:Array,default:()=>[]},specificClass:{type:String,default:""},visibleItems:{type:Number,default:4},type:{type:String,default:""}},data(){return{selectedItemIndex:0,showForwardControl:!1,showBackwardControl:!1,addToCartIndexPushed:1}},computed:{...Y("selectorState",{isModalSizesOpen:"getModalStatus"}),...Y("pdp",{mustShowCrossSellingPromotions:"mustShowCrossSellingPromotions"})},methods:{handleSelectedIndex(r){this.selectedItemIndex=r,this.showForwardControl=this.canScrollToEnd(),this.showBackwardControl=this.canScrollToStart()},canScrollToEnd(){return this.selectedItemIndex+this.visibleItems<this.products.length},canScrollToStart(){return this.selectedItemIndex>0},scrollForward(){this.canScrollToEnd()&&(this.selectedItemIndex+=1)},scrollBackward(){this.canScrollToStart()&&(this.selectedItemIndex-=1)},updateAddToCartIndexPushed(){this.addToCartIndexPushed+=1}}},Re={key:0,id:"cross-selling-title",class:"product_detail-title","data-custom-brand":"","data-testid":"crossSellingTitle"},Ae={class:"cross-selling__scroll-container"},Te={class:"cross-selling__item"};function Ge(r,a,e,o,f,c){const l=A("ProductPreview"),h=A("MultiCarousel"),u=A("AsyncStock");return v(),C("div",{class:ae(["cross-selling__container",e.specificClass])},[e.title?(v(),C("h2",Re,re(e.title),1)):D("",!0),j("div",Ae,[T(u,{products:e.products},{default:J(({stockProducts:p})=>[T(h,{items:p,"visible-items":e.visibleItems,"selected-item-index":f.selectedItemIndex,"wheel-drag":!0,"disable-scroll":r.isModalSizesOpen,onSelectedIndex:c.handleSelectedIndex},{default:J(m=>[j("div",Te,[T(l,{product:m.item,active:!1,"cross-selling-type":e.type,"add-to-cart-index-pushed":f.addToCartIndexPushed,"data-layer":e.dataLayer[m.index],"force-show-brand":!0,position:m.index+1,onIndexPushedUpdate:c.updateAddToCartIndexPushed},null,8,["product","cross-selling-type","add-to-cart-index-pushed","data-layer","position","onIndexPushedUpdate"])])]),_:2},1032,["items","visible-items","selected-item-index","disable-scroll","onSelectedIndex"])]),_:1},8,["products"]),f.showForwardControl?(v(),C("div",{key:0,class:"scroll-control scroll-control__forward",onClick:a[0]||(a[0]=(...p)=>c.scrollForward&&c.scrollForward(...p))})):D("",!0),f.showBackwardControl?(v(),C("div",{key:1,class:"scroll-control scroll-control__backward",onClick:a[1]||(a[1]=(...p)=>c.scrollBackward&&c.scrollBackward(...p))})):D("",!0)])],2)}const xe=B(Ie,[["render",Ge]]),Ee={components:{CrossSelling:xe},props:{brandName:{type:String,required:!1,default:void 0},categoryId:{type:String,required:!1,default:void 0},forceRecall:{type:Boolean,default:!1},pageType:{type:String,required:!0},productId:{type:String,default:void 0},searchTerm:{type:String,default:void 0},showContent:{type:Boolean,default:!0}},setup(r){const{getRichRelevanceProducts:a}=Pe(),{forceRecall:e}=X(r),o=M({}),{isMobileDevice:f}=Se(),{isLogged:c,getUser:l}=fe("cart",{isLogged:"isLogged",getUser:"getUser"});ne(e,d=>{d&&h()}),Q(()=>{h()});async function h(){var P;const d=(c==null?void 0:c.value)&&((P=l==null?void 0:l.value)==null?void 0:P.id),y=ce.getCookieValue("session_id"),g={brandName:r.brandName,categoryId:r.categoryId,pageType:r.pageType,productId:r.productId,searchTerm:r.searchTerm,rrCookie:u(),session_id:y};d&&(g.pw=d),o.value=await a(g),p(o.value.rrCookie),m(o.value)}function u(){if(!(typeof window>"u"))return window.sessionStorage.getItem("rrCookie")}function p(d){if(d){if(typeof window>"u")return;window.sessionStorage.setItem("rrCookie",d)}}function m(){var d,y;(d=o.value)!=null&&d.placements&&((y=o.value)==null||y.placements.forEach((g,P)=>{const G="rr";ge.sendProductModulesPrint(g.datalayer,G,P,g.placementTitle)}))}return{isMobileDevice:f,richRelevanceData:o,CROSS_SELLING_TYPES:_e}}};function be(r,a,e,o,f,c){var h;const l=A("CrossSelling");return v(!0),C(le,null,ie((h=o.richRelevanceData)==null?void 0:h.placements,(u,p)=>(v(),C("div",{key:p},[T(l,{"data-testid":"cross-selling__container__plp_rr",dataLayer:u.datalayer,products:u.products,"specific-class":"cross-selling__container__plp_rr",title:u.placementTitle,type:o.CROSS_SELLING_TYPES.RR,"visible-items":o.isMobileDevice?1.25:void 0},null,8,["dataLayer","products","title","type","visible-items"])]))),128)}const Ue=B(Ee,[["render",be]]),Ve=Object.freeze({ADD_TO_CART_PAGE:"add_to_cart_page",CART_PAGE:"cart_page",HOME_PAGE:"home_page",STATIC_PAGE:"static_page",SEARCH_PAGE:"search_page",CATEGORY_PAGE:"category_page",ITEM_PAGE:"item_page",BRAND_PAGE:"brand_page",ERROR_PAGE:"error_page"});export{xe as C,Ve as P,Ue as R,ke as u};
//# sourceMappingURL=pageTypes-90141d6b.js.map
